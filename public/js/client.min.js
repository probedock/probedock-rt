/*
 * probedock-rt - v0.0.1
 * Copyright (c) 2015-08-03 Probe Dock
 * 
 */
var DEBUG=!1,ProbeDockRT=window.ProbeDockRT={version:"0.0.2"};(function(){Marionette.Renderer.render=function(t,e){if(!_.isUndefined(t)){var i="function"==typeof t?t:Marionette.TemplateCache.get(t);return i(e)}}}).call(this),function(){_.mixin({formatDurationUnit:function(t,e){return t>0?t+e:"0"+e},formatDuration:function(t,e){var i=moment.duration(t);e=_.defaults(e||{},{units:{h:"hours",m:"minutes",s:"seconds",ms:"milliseconds"},skipZeroValues:!1});var s=_.reduce(e.units,function(t,s,n){return t.length>0&&i[s]()>0?t+" "+_.formatDurationUnit(i[s](),n):i[s]()>0?_.formatDurationUnit(i[s](),n):t.length>0&&!e.skipZeroValues?t+" "+_.formatDurationUnit(0,n):t},"");return s.length>0?s:"0"+_.last(_.keys(e.units))},now:function(){return moment().format("MMMM Do YYYY, h:mm:ss a")},defaultValue:function(t,e){return _.isUndefined(t)||_.isNull(t)||""===t?_.isUndefined(e)||_.isNull(e)||""===e?"Undefined":e:t},titleize:function(t,e,i){return e+" - "+t+" - "+i},coordinates:function(t,e,i){return _.str.slugify(_.titleize(t,e,i))},crc:function(t){var e,i=305419896;for(e=0;t.length>e;e++)i+=t.charCodeAt(e)*e;return i}})}.call(this),function(){function t(t){this.summaries={},this.stats={},this.size=0,t&&(this.name=t),this.crcId=null,this.total={passed:0,failed:0,inactive:0,all:0,duration:0}}function e(){this.items={},this.size=0}var i=Backbone.Model.extend({});_.extend(t.prototype,{create:function(e){if(!this.exists(e)){var i=new t(e);this.summaries[e]=i,i.parent=this,this.size++}},childrenSize:function(){var t=0;return 0===_.size(this.summaries)?1:(_.each(this.summaries,function(e){t+=e.childrenSize()}),_.size(this.summaries)>1&&(t+=1),t)},exists:function(t){return!_.isUndefined(this.summaries[t])},find:function(t){return this.summaries[t]},hasCrcId:function(){return!_.isUndefined(this.crcId)},hasStat:function(t){return!_.isUndefined(this.stats[t])},findStat:function(t){return this.stats[t]},addStat:function(t,e){this._subOrAddStat(1,e),this.parent&&(this.parent.addStat(t,e),0===_.size(this.summaries)&&(this.stats[t]=e))},subStat:function(t,e){this._subOrAddStat(-1,e),this.parent&&this.parent.subStat(t,e)},_subOrAddStat:function(t,e){e.inactive?this.total.inactive+=t:e.passed?this.total.passed+=t:this.total.failed+=t,this.total.all+=t,this.total.duration+=e.duration*t,this.model&&this.model.trigger("stats:updated")}}),ProbeDockRT.ProjectSummaryCollection=Backbone.Collection.extend({initialize:function(){this.summary=new t},addOrUpdate:function(t){var e=t.get("version"),i=t.get("project"),s=t.get("category"),n=t.get("id"),a=!1,o=this.summary;_.each([e,i,s],function(t){o.exists(t)||(a=!0,o.create(t)),o=o.find(t),o.crcId=_.crc(_.coordinates(i,e,s))},this);var r={passed:t.get("passed"),inactive:!t.get("active"),duration:t.get("duration")};o.hasStat(n)&&o.subStat(n,o.findStat(n)),o.addStat(n,r),a&&this.fetch()},reset:function(e,i){e||(delete this.summary,this.summary=new t),Backbone.Collection.prototype.reset.call(this,e,i)},sync:function(t,e,i){var s=this,n=i.success;i.success=function(t){n(t),s.trigger("fetched")};var a=this,o=[];this.summary.size>0&&(_.each(this.summary.summaries,function(t){var e=t.name,i=t.childrenSize();_.each(t.summaries,function(t){var s=t.name,n=t.childrenSize();_.each(t.summaries,function(t){var r=t.name;t.model=a._createSummaryModel(o,e,i,s,n,r,t.total,t.crcId),i>0&&(i=0),n>0&&(n=0)}),t.size>1&&(t.model=a._createSummaryModel(o,e,0,s,0,"Total",t.total))}),t.size>1&&(t.model=a._createSummaryModel(o,e,0,"Total",1,"",t.total))}),this.summary.size>1&&(this.summary.model=this._createSummaryModel(o,"Total",1,"",1,"",this.summary.total))),i.success(o)},refresh:function(){this.reset(),this.fetch()},getInfo:function(){return{}},updateInfo:function(){this.fetch()},_createSummaryModel:function(t,e,s,n,a,o,r,l){var c=new i({version:e,versionSize:s,project:n,projectSize:a,category:o,stats:r,crcId:l});return t.push(c),c}}),_.extend(e.prototype,{add:function(t,e){e instanceof Backbone.Model&&(this.exists(t)||this.size++,this.items[t]=e)},remove:function(t){this.exists(t)&&(this.items=_.omit(this.items,t),this.size--)},exists:function(t){return!_.isUndefined(this.items[t])},find:function(t){return this.items[t]},empty:function(){delete this.items,this.items={},this.size=0},toArray:function(){return _.toArray(this.items)}}),ProbeDockRT.ProjectModel=Backbone.Model.extend(),ProbeDockRT.ProjectCollection=Backbone.Collection.extend({model:ProbeDockRT.ProjectModel,initialize:function(){this.meta={page:1,perPage:100,term:"",sort:{}}},comparator:function(t){return t.get("id")},sync:function(t,e,i){var s=this,n=i.success;i.success=function(t){n(t),s.trigger("fetched")},i.success(this.models)},refresh:function(){this.reset(),this.fetch()},getInfo:function(){return this.meta},updateInfo:function(t){this.each(function(e){e.get("tests").updateInfo(t)})}}),ProbeDockRT.TestModel=Backbone.Model.extend({orderableFields:["id","name","duration","passed"]});var s=Backbone.Collection.extend({model:ProbeDockRT.TestModel,pagerEnabled:!1,initialize:function(t,i){this.originalModels=new e;var s=null;i&&i.meta&&(s=i.meta),this.meta=_.defaults(s||{},{page:1,perPage:10,term:"",sort:{}}),i.externalState&&(this.externalState=i.externalState)},reset:function(t,i){t||(delete this.originalModels,this.originalModels=new e),Backbone.Collection.prototype.reset.call(this,t,i)},getFromOriginals:function(t){return this.originalModels.exists(t)?this.originalModels.find(t):null},filter:function(t){return _.reduce(t,function(t,e){return this._modelFilter(e)&&t.push(e),t},[],this)},refresh:function(){this.reset(),this.fetch()},getInfo:function(){return this.meta},updateInfo:function(t){t&&(t.externalState&&(this.externalState=t.externalState,t=_.omit(t,"externalState")),this.meta=_.defaults(t,this.meta)),this.fetch()},_modelFilter:function(t){var e=!1,i=this.externalState.state.filters.text;return(""===i||""!==i&&(_.str.include(t.get("id"),i)||_.str.include(t.get("name"),i)||_.str.include(t.get("flatten_tags"),i)||_.str.include(t.get("flatten_tickets"),i)||_.str.include(t.get("message"),i)))&&(e=!0),e&&(e=this.externalState.state.filters.status.inactive&&!t.get("active"),!e&&t.get("active")&&(this.externalState.state.filters.status.passed&&t.get("passed")||this.externalState.state.filters.status.failed&&!t.get("passed"))&&(e=!0)),e}});ProbeDockRT.TestCollection=s.extend({slice:function(t){return this.meta.pages=Math.ceil(t.length/this.meta.perPage),this.meta.totalItems=t.length,this.meta.from=(this.meta.page-1)*this.meta.perPage,this.meta.to=this.meta.from+this.meta.perPage,this.meta.from>t.length&&(this.meta.from=t.length-this.meta.perPage,this.meta.to=this.meta.from+this.meta.perPage,this.meta.page=Math.ceil(this.meta.from/this.meta.perPage)+1,0>this.meta.from&&(this.meta.from=0,this.meta.to=this.meta.perPage,this.meta.page=1)),t=t.slice(this.meta.from,this.meta.to),this.meta.from++,t},_sort:function(t){var e=this;return t.sort(function(t,i){var s=0;return _.each(e.meta.sort,function(e,n){var a=(""+t.get(t.orderableFields[n])).toLowerCase(),o=(""+i.get(i.orderableFields[n])).toLowerCase(),r=a.localeCompare(o);0!==r&&(s=r*("A"===e?1:-1))}),s})},add:function(t,e){if(t instanceof Backbone.Model){if(this.originalModels.add(t.get("id"),t),this._modelFilter(t)&&(!this.externalState.state.paging||this.externalState.state.paging&&this.models.length<this.meta.perPage)&&Backbone.Collection.prototype.add.call(this,t,e),!this._debouncedInfo){var i=this;this._debouncedInfo=_.debounce(function(){i.meta.totalItems=i.originalModels.size,i.meta.pages=Math.ceil(i.originalModels.size/i.meta.perPage),i.trigger("info:updated")},100)}this._debouncedInfo()}else Backbone.Collection.prototype.add.call(this,t,e)},sync:function(t,e,i){var s=this,n=i.success;i.success=function(t){n(t),s.trigger("fetched")};var a=this.originalModels.toArray();a=this.filter(a),this.externalState.state.paging&&(a=this._sort(a),a=this.slice(a)),i.success(a)}}),ProbeDockRT.TestDetailsCollection=s.extend({comparator:function(t){return-t.get("order")},add:function(t,e){t instanceof Backbone.Model?(this.originalModels.add(t.get("id"),t),this._modelFilter(t)&&Backbone.Collection.prototype.add.call(this,t,e)):Backbone.Collection.prototype.add.call(this,t,e)},remove:function(t,e){t instanceof Backbone.Model&&this.originalModels.remove(t.get("id")),Backbone.Collection.prototype.remove.call(this,t,e)},sync:function(t,e,i){var s=this,n=i.success;i.success=function(t){n(t),s.trigger("fetched")};var a=this.originalModels.toArray();a=this.filter(a),i.success(a)}})}.call(this),function(){var t={filters:{text:"",status:{passed:!0,failed:!0,inactive:!0}},paging:!1};window.ProbeDockRT.app=new(Marionette.Application.extend({externalState:{state:_.clone(t)},defaultMode:"squares",detailsCounter:0,projects:new ProbeDockRT.ProjectCollection,summary:new ProbeDockRT.ProjectSummaryCollection,updateFilters:function(t){this.externalState.state.filters=t,this.trigger("filter",{externalState:this.externalState})},switchView:function(t){this.viewMode=t,this.externalState.state.paging="squares"!==t,this.trigger("show:results:"+t)},refreshAll:function(){this.trigger("show:results:"+this.defaultMode),this.trigger("show:details")},reset:function(){this.externalState.state=_.clone(t),this.refreshAll()},clear:function(){this.externalState.state=_.clone(t),this.details.reset(),this.projects.reset(),this.summary.reset(),this.detailsCounter=0,this.trigger("show:results:"+this.viewMode)},processPayload:function(t){var e={failed:0,passed:0,inactive:0,total:0,duration:0},i=this;_.each(t.r,function(t){_.each(t.t,function(s){i.processTestResult(s,t.j,t.v),e.total++,e.passed+=s.p&&1!=s.f?1:0,e.failed+=s.p||1==s.f?0:1,e.inactive+=1==s.f?1:0,e.duration+=s.d})}),this.trigger("notify:stats",e)},processTestResult:function(t,e,i){var s=_.defaultValue(t.j,e),n=_.defaultValue(t.v,i),a=_.defaultValue(t.c,null),o=_.coordinates(s,n,a);this.addProjectFromTestResult(o,s,n,a,t.k);var r={key:t.k,name:t.n,passed:t.p,duration:t.d,active:t.e,message:t.m,flatten_tags:t.g.join(","),flatten_tickets:t.t.join(","),tags:t.g,tickets:t.t,data:t.a,project:s,version:n,category:a,fingerprint:t.f};this.addOrUpdateTest(o,r)},addOrUpdateTest:function(t,e){var i;_.isUndefined(this.projects.get(t).get("tests").get(e.fingerprint))?(i=new ProbeDockRT.TestModel(_.extend(e,{id:e.fingerprint})),this.projects.get(t).get("tests").add(i),!i.get("passed")&&i.get("active")&&(i.set("order",this.detailsCounter++),this.addTestDetails(i))):(i=this.projects.get(t).get("tests").get(e.fingerprint),i.set(e),!i.get("passed")&&i.get("active")&&(i.set("order",this.detailsCounter++),this.updateDetailResult(i))),this.summary.addOrUpdate(i)},addProjectFromTestResult:function(t,e,i,s){if(_.isUndefined(this.projects.get(t))){var n=new ProbeDockRT.TestCollection({},{externalState:this.externalState});n.listenTo(this,"filter",n.updateInfo),this.projects.add(new ProbeDockRT.ProjectModel({id:t,crcId:_.crc(t),name:e,originalName:e,version:i,originalVersion:i,category:s,originalCategory:s,title:_.titleize(e,i,s),tests:n}))}},updateDetailResult:function(t){_.isUndefined(this.details.get(t.get("id")))&&this.details.add(t)},addTestDetails:function(t){if(t){var e=t;_.isString(e)&&this.projects.each(function(t){_.isString(e)&&t.get("tests").getFromOriginals(e)&&(e=t.get("tests").getFromOriginals(e))}),e.set("order",this.detailsCounter++),this.details.getFromOriginals(e.get("id"))?this.details.sort():this.details.add(e)}},removeTestDetails:function(t){t&&this.details.remove(t)}})),ProbeDockRT.app.addInitializer(function(){this.addRegions({main:".main"}),this.details=new ProbeDockRT.TestDetailsCollection({},{externalState:this.externalState}),this.details.listenTo(this,"filter",this.details.updateInfo),this.on("change:view",function(t){this.switchView(t)},this),this.on("payload:received",function(t){this.processPayload(t)},this),this.on("test:result:received",function(t){this.processTestResult(t,null,null)}),this.on("add:test:details",function(t){this.addTestDetails(t)},this),this.on("remove:test:details",function(t){this.removeTestDetails(t)},this),this.on("reset",function(){this.reset()},this),this.on("clear",function(){this.clear()},this),this.on("filters:update",function(t){this.updateFilters(t)})})}.call(this),function(){ProbeDockRT.app.addInitializer(function(){var t=this;this.socket=io.connect(window.location.protocol+"//"+window.location.host);var e="Probe Dock RT Agent",i="Connection to "+e+" established";this.socket.on("connect",function(){t.trigger("notify:message",i,"success"),t.trigger("filters:set"),i="You have been reconnected to "+e}),this.socket.on("error",function(e){t.trigger("notify:message","Unexpected error occurred: "+e,"error")}),this.socket.on("disconnect",function(){t.trigger("notify:message","You have been disconnected from the "+e,"error")}),this.socket.on("reconnecting",function(i){t.trigger("notify:reconnect","Attempt to reconnect in {countdown} to the "+e+" is in progress",i)}),this.socket.on("payload",function(e){try{e&&t.trigger("payload:received",JSON.parse(e))}catch(i){t.trigger("notify:message","Unable to parse and show the data: "+i,"error")}}),this.socket.on("run:start",function(e){t.trigger("notify:run:start",e)}),this.socket.on("run:test:result",function(e){e&&(t.trigger("notify:run:test:result",e),t.trigger("test:result:received",e))}),this.socket.on("run:end",function(e){t.trigger("notify:run:end",e)}),this.on("filters:set",function(t){!_.isUndefined(t)&&t.length>0?this.socket.emit("filters:set",{filters:t}):this.socket.emit("filters:reset")},this),this.socket.emit("filters:set",{filters:[]}),DEBUG&&this.socket.emit("payload:get",function(e){try{e&&t.trigger("payload:received",JSON.parse(e))}catch(i){t.trigger("notify:message","Unable to parse and show the data: "+i,"error")}})})}.call(this),function(){ProbeDockRT.TooltipableView=Marionette.ItemView.extend({defaultTooltipable:".btn",onRender:function(){this.initTooltip(this.$el.find(this._tooltipable())),this.delegateEvents(this.events)},initTooltip:function(t){t.tooltip({container:"body",placement:"bottom",delay:{show:750},trigger:"hover"})},_tooltipable:function(){return _.isUndefined(this.tooltipable)?this.defaultTooltipable:_.isFunction(this.tooltipable)?this.tooltipable():this.tooltipable}})}.call(this),function(){var t=_.debounce(function(t,e){t.trigger("filters",e)},300),e=ProbeDockRT.TooltipableView.extend({filters:{text:"",status:{passed:!0,failed:!0,inactive:!0}},events:{"mouseover .btn":"helpOn","mouseout .btn":"helpOff","click .toolbar-status > .btn":"statusFiltering","click .toolbar-view > .btn":"switchView","click .toolbar-reset > .btn":"reset","click .toolbar-clear > .btn":"clear","keyup .text-filter > input":"textFiltering","keypress .text-filter > input":"avoidSubmit"},ui:{passedBtn:".toolbar-status > .btn-success",failedBtn:".toolbar-status > .btn-danger",inactiveBtn:".toolbar-status > .btn-warning",squaresBtn:'.toolbar-view > [data-mode="squares"]',textFilter:".text-filter > input"},statusFiltering:function(e){e.preventDefault(),e.stopPropagation(),$(e.target).button("toggle"),_.each(_.keys(this.filters.status),function(t){this.filters.status[t]=this.ui[t+"Btn"].hasClass("active")},this),t(this,this.filters)},textFiltering:function(e){e.preventDefault(),e.stopPropagation(),this.filters.text=this.ui.textFilter.val(),t(this,this.filters)},avoidSubmit:function(t){13==t.keyCode&&(t.preventDefault(),t.stopPropagation())},switchView:function(t){t.preventDefault(),$(t.target).hasClass("active")||this.trigger("view:switch",$(t.target).data("mode"))},reset:function(){_.each(_.keys(this.filters.status),function(t){this.ui[t+"Btn"].hasClass("active")||this.ui[t+"Btn"].button("toggle"),this.filters.status[t]=!0},this),this.ui.squaresBtn.button("toggle"),this.ui.textFilter.val(""),this.trigger("reset")},clear:function(t){t.preventDefault(),this.trigger("clear")}});ProbeDockRT.app.addInitializer(function(t){this.addRegions({toolbarRegion:".toolbar"});var i=new e(_.extend({el:$(".toolbar-container")},t));i.on("filters",function(t){this.trigger("filters:update",t)},this),i.on("view:switch",function(t){this.trigger("change:view",t)},this),i.on("reset",function(){this.trigger("reset")},this),i.on("clear",function(){this.trigger("clear")},this),this.toolbarRegion.attachView(i.render())})}.call(this),function(){var t=ProbeDockRT.TooltipableView.extend({filters:[],ui:{filter:"#filterField",filterElements:".filter-elements"},icons:{key:{ico:"key",title:"Key filter"},fp:{ico:"hand-up",title:"Fingerprint filter",reduce:function(t){return t.length>9?t.substr(0,3)+"..."+t.substr(t.length-3):t}},name:{ico:"reorder",title:"Name filter",reduce:function(t){return t.length>10?t.substr(0,9)+"...":t}},tag:{ico:"tag",title:"Tag filter"},project:{ico:"book",title:"Project filter"},ticket:{ico:"list-alt",title:"Ticket filter"},"*":{ico:"asterisk",title:"Generic filter"}},iconRegex:/(.*):(.*)/,events:{"click .filter-add":"addFilterEvent","keyup #filterField":"addFilterFromKeyboard","click .filter-element-close":"removeFilter","click .filter-element-text":"removeFilter","click .filter-clearall":"clearAll","mouseover .filter-icon":"helpOn","mouseout .filter-icon":"helpOff"},addFilterFromKeyboard:function(t){13==t.keyCode&&this.addFilterEvent(t)},addFilterEvent:function(t){t.preventDefault();var e=_.str.trim(this.ui.filter.val()),i=null;_.each(this.icons,function(t,s){_.str.startsWith(e,s+":")&&(e=e.replace(s+":",""),i=s)}),this.addFilter(i,e)},addFilter:function(t,e){if(e=_.str.trim(e),t||(t="*"),!_.find(this.filters,function(i){return i.type==t&&i.text==e})){this.filters.push({type:t,text:e});var i,s="";this.icons[t]&&(i=this.icons[t],s='<i class="icon-'+i.ico+' filter-icon" title="'+i.title+'"></i>');var n;n=_.isUndefined(this.icons[t].reduce)?e:this.icons[t].reduce(e);var a=$('<span class="filter-element-text">'+s+n+'</span><button class="filter-element-close"><i class="icon-remove-sign"></i></button>');this.initTooltip(a.find("i"));var o=$('<div class="filter-element"></div>').append(a).data("filter",e);this.ui.filterElements.append(o),this.ui.filter.val(""),this.trigger("filters:set",this.filters)}},removeFilter:function(t){var e=$(t.target).closest(".filter-element");if(e.length>0){var i=e.data("filter");this.filters=_.reject(this.filters,function(t){return t.text===i}),e.find("i").tooltip("hide"),e.remove(),this.trigger("filters:set",this.filters)}},clearAll:function(){this.ui.filterElements.children().length>0&&(this.filters=[],this.ui.filterElements.tooltip("hide"),this.ui.filterElements.empty(),this.trigger("filters:set",this.filters))}});ProbeDockRT.app.addInitializer(function(e){this.addRegions({filtersRegion:".filters"});var i=new t(_.extend({el:".filters-container"},e));i.listenTo(this,"filter:add",i.addFilter),this.listenTo(i,"filters:set",function(t){this.trigger("filters:set",t)}),this.filtersRegion.attachView(i.render())})}.call(this),function(){ProbeDockRT.NotificationContainerView=ProbeDockRT.TooltipableView.extend({tooltipable:".notifications-ack",ui:{nonotification:".no-notification",notifications:".notifications"},events:{"click .notifications-ack":"ackNotifications"},showNotification:function(t){0===this.ui.notifications.children().length&&(this.ui.nonotification.hide(),this.ui.nonotification.text("No more notifications"),this.ui.notifications.show()),this.listenTo(t,"closed",function(){0===this.ui.notifications.children().length&&(this.ui.nonotification.show(),this.ui.notifications.hide())},this),t.render(),this.ui.notifications.prepend(t.$el)},ackNotifications:function(t){t.preventDefault(),this.ui.notifications.find("notification").alert("close"),this.ui.nonotification.show(),this.ui.notifications.hide(),this.ui.notifications.empty()}})}.call(this),function(){ProbeDockRT.NotificationView=Marionette.ItemView.extend({defaultClassName:"alert notification",events:{"click .notification-close":"closeNotification"},templateHelpers:function(){return{titleHelper:this.title?this.title:function(t){return"<h4>"+t.title+"</h4>"},contentHelper:this.contentTemplate?this.contentTemplate:function(){return""}}},template:function(t){return'<div class="text-left" /><button class="notification-close" data-dismiss="alert"><i class="icon-remove"></i></button>'+t.titleHelper(t)+'<span><i class="icon-time"></i>&nbsp;'+_.now()+"</span><hr />"+t.contentHelper(t)+"</div>"},className:function(){return this.additionalClassName?_.isFunction(this.additionalClassName)?this.defaultClassName+" "+this.additionalClassName():this.defaultClassName+" "+this.additionalClassName:this.defaultClassName},serializeData:function(){return _.extend(Marionette.ItemView.prototype.serializeData.apply(this),{title:this.options.title})},onRender:function(){var t=this;this.$el.click(function(e){t.closeNotification(e)})},closeNotification:function(){this.$el.alert("close"),this.remove(),this.trigger("closed")}})}.call(this),function(){ProbeDockRT.StatisticsNotificationView=ProbeDockRT.NotificationView.extend({additionalClassName:"alert-success",contentTemplate:function(t){return"<span>Tests: "+t.total+", "+"Passed: "+t.passed+", "+"Failed: "+t.failed+", "+"Inactive: "+t.inactive+", "+"Duration: "+_.formatDuration(t.duration)+"</span>"}})}.call(this),function(){ProbeDockRT.MessageNotificationView=ProbeDockRT.NotificationView.extend({additionalClassName:function(){return"alert-"+this.options.type},title:function(t){var e="",i="";switch(t.type){case"success":e="Success",i="ok-sign";break;case"warning":e="Warning",i="warning-sign";break;case"error":e="Error",i="exclamation-sign";break;default:e="Info",i="question-sign"}return'<h4><i class="icon-'+i+'"></i>&nbsp;'+e+"</h4>"},contentTemplate:function(t){return"<p>"+t.message+"</p>"},serializeData:function(){return _.extend(ProbeDockRT.NotificationView.prototype.serializeData.apply(this),{type:this.options.type})}})}.call(this),function(){ProbeDockRT.ReconnectNotificationView=ProbeDockRT.MessageNotificationView.extend({ui:{countdown:".countdown"},onRender:function(){this.ui.countdown.text(_.formatDuration(this.model.get("duration"),{units:{m:"minutes",s:"seconds"},skipZeroValues:!0}));var t=this,e=setInterval(function(){t.model.set("duration",t.model.get("duration")-1e3),t.ui.countdown.text(_.formatDuration(t.model.get("duration"),{units:{m:"minutes",s:"seconds"},skipZeroValues:!0})),0==t.model.get("duration")&&clearInterval(e)},1e3)},contentTemplate:function(t){return"<p>"+t.message.replace("{countdown}",'<span class="countdown" />')+"</p>"}})}.call(this),function(){ProbeDockRT.TestRunNotificationView=ProbeDockRT.NotificationView.extend({additionalClassName:"alert-info",contentTemplate:function(t){return"<p><span>Project: "+t.project.apiId+"</span><br />"+"<span>Version: "+t.project.version+"</span><br />"+"<span>Category: "+t.category+"</span>"+(t.start?"":"<br /><span>Duration: "+_.formatDuration(t.duration)+"</span>")+"</p>"}})}.call(this),function(){ProbeDockRT.TestNotificationView=ProbeDockRT.NotificationView.extend({additionalClassName:"alert-info",events:{"click .test-notification":"showTestDetails"},ui:{key:"code"},title:function(t){var e;e=t.k?'<code class="code-key" data-fp="'+t.f+'">'+t.k+"</code>":'<code class="code-fingerprint" data-fp="'+t.f+'">'+t.f+"</code>";var i='<span class="test-notification {testNotificationClass}"><i class="{icon}"></i>&nbsp;Test '+e+" {statusText}</span>";return i=i.replace("{statusText}",t.p?"passed":"failed").replace("{icon}",t.p?"icon-thumbs-up":"icon-thumbs-down"),i=t.e?i.replace("{testNotificationClass}",t.p?"test-notification-passed":"test-notification-failed"):i.replace("{testNotificationClass}","test-notification-inactive"),"<h4>"+i+"</h4>"},contentTemplate:function(t){return"<p>"+t.n+"</p>"},showTestDetails:function(t){t.preventDefault(),t.stopPropagation(),t.altKey?this.trigger("filter","fp",this.ui.key.data("fp")):this.trigger("show:details",this.ui.key.data("fp"))}})}.call(this),function(){ProbeDockRT.app.addInitializer(function(t){this.addRegions({notifications:".notifications-outer-container"});var e=new ProbeDockRT.NotificationContainerView(_.extend({el:$(".notifications-inner-container")},t));e.listenTo(this,"notify:stats",function(t){e.showNotification(new ProbeDockRT.StatisticsNotificationView({model:new Backbone.Model(t),title:"Test results received"}))}),e.listenTo(this,"notify:message",function(t,i){e.showNotification(new ProbeDockRT.MessageNotificationView({model:new Backbone.Model({message:t}),type:i}))}),e.listenTo(this,"notify:reconnect",function(t,i){e.showNotification(new ProbeDockRT.ReconnectNotificationView({model:new Backbone.Model({message:t,duration:i}),type:"info"}))}),e.listenTo(this,"notify:run:start",function(t){e.showNotification(new ProbeDockRT.TestRunNotificationView({model:new Backbone.Model(_.extend(t,{start:!0})),title:"Test run started"}))}),e.listenTo(this,"notify:run:end",function(t){e.showNotification(new ProbeDockRT.TestRunNotificationView({model:new Backbone.Model(_.extend(t,{start:!1})),title:"Test run ended"}))}),e.listenTo(this,"notify:run:test:result",function(t){var i=new ProbeDockRT.TestNotificationView({model:new Backbone.Model(t)});ProbeDockRT.app.listenTo(i,"show:details",function(t){this.trigger("add:test:details",t)},ProbeDockRT.app),ProbeDockRT.app.listenTo(i,"filter",function(t,e){this.trigger("filter:add",t,e)},ProbeDockRT.app),e.showNotification(i)}),this.notifications.attachView(e.render())})}.call(this),function(){var t=Dg.HeaderView.extend({template:function(){return'<tr><th class="th-version">Version</th><th class="th-project">Project</th><th class="th-category">Category</th><th class="center">Passed</th><th class="center">Failed</th><th class="center">Inactive</th><th class="center">All</th><th class="center">Duration</th></tr>'}}),e=Dg.RowView.extend({ui:{passed:".passed",failed:".failed",inactive:".inactive",all:".all",duration:".duration"},initialize:function(){this.listenTo(this.model,"stats:updated",function(){var t=this.model.get("stats");this.ui.passed.text(t.passed),this.ui.failed.text(t.failed),this.ui.inactive.text(t.inactive),this.ui.all.text(t.all),this.ui.duration.text(_.formatDuration(t.duration))},this)},template:function(t){var e="";t.versionSize>0&&(e='<td class="cell-header" rowspan="'+t.versionSize+'">'+t.version+"</td>");var i="";t.projectSize>0&&(i='<td class="cell-header" rowspan="'+t.projectSize+'">'+t.project+"</td>");var s="&nbsp;";return""!==t.category&&"Total"!==t.category?s='<a href="#'+t.crcId+'">'+t.category+"</a>":"Total"===t.category&&(s=t.category),e+i+"<td>"+s+"</td>"+'<td class="center"><span class="badge badge-success passed">'+t.stats.passed+"</span></td>"+'<td class="center"><span class="badge badge-important failed">'+t.stats.failed+"</span></td>"+'<td class="center"><span class="badge badge-warning inactive">'+t.stats.inactive+"</span></td>"+'<td class="center"><span class="badge badge-info all">'+t.stats.all+"</span></td>"+'<td class="right"><span class="duration">'+_.formatDuration(t.stats.duration)+"</span></td>"}}),i=Dg.EmptyView.extend({template:function(){return'<td><h4 class="text-error text-center">Run some test to see the results</h4></td>'}}),s=Dg.createGridLayout({gridRegions:{table:{view:Dg.TableView.extend({itemView:e,headerView:t,emptyView:i,template:function(){return'<table class="table table-condensed"><tbody/></table>'}})},perPage:!1,toolbar:!1,pager:!1,quickSearch:!1,info:!1}});ProbeDockRT.app.addInitializer(function(){this.addRegions({summaryRegion:".summary"}),this.summaryRegion.show(new s({collection:ProbeDockRT.app.summary}))})}.call(this),function(){var t=new Backbone.Wreqr.EventAggregator,e=Dg.HeaderView.extend({parentSelector:".clearfix",tagName:"div",serializeData:function(){return{title:this.options.title,crcId:this.options.crcId}},template:function(t){return'<a id="'+t.crcId+'"></a><h3>'+t.title+"</h3>"}}),i=Dg.RowView.extend({tagName:"div",className:"square-test pull-left",events:{click:"showDetails",mouseover:"showTitle",mouseout:"hideTitle"},template:function(){return""},initialize:function(){this.listenTo(this.model,"change",this.render)},onRender:function(){var t;t=this.model.get("active")?this.model.get("passed")?"btn-success square-test-success":"btn-danger square-test-fail":"btn-warning square-test-inactive",this.$el.popover({title:'<span class="square-popover-title">'+this.model.get("id").substr(0,10)+"...</code>",content:'<span class="square-popover-content">'+this.model.get("name")+"</span>",html:!0,container:this.$el}),this.$el.removeClass("btn-warning btn-success btn-error square-test-inactive square-test-success square-test-fail").addClass(t),this.delegateEvents()},showDetails:function(e){e.preventDefault(),t.trigger("show:test:details",this.model)},showTitle:function(t){t.preventDefault(),this.$el.popover("show")},hideTitle:function(t){t.preventDefault(),this.$el.popover("hide")}}),s=Dg.createGridLayout({gridRegions:{table:{view:Dg.TableView.extend({itemViewContainer:".square-tests",itemView:i,headerView:e,template:function(){return'<div class="clearfix"><div class="square-tests"></div></div>'},initialize:function(t){t=_.extend(t,{title:this.model.get("title"),crcId:this.model.get("crcId")})}})},perPage:!1,toolbar:!1,pager:!1,quickSearch:!1,info:!1}}).extend({className:"box test-report",initialize:function(t){this.collection=t.model.get("tests")}}),n=Marionette.CollectionView.extend({itemView:s});ProbeDockRT.app.addInitializer(function(){var e=new n({collection:this.projects});this.on("show:results:squares",function(){this.main.show(e)},this),t.on("show:test:details",function(t){this.trigger("add:test:details",t)},this),this.main.show(e)})}.call(this),function(){var t=new Backbone.Wreqr.EventAggregator,e=Dg.PagerView.extend({css:{disabled:"disabled page-disabled"}}),i=Dg.HeaderView.extend({css:{sortable:"sorting",asc:"icon-sort-up",desc:"icon-sort-down",none:"icon-sort"},template:function(){return'<th class="s center">Key</th><th>Name</th><th class="s center">Duration</th><th class="s center">Status</th>'}}),s=Dg.RowView.extend({events:{"click .key":"_addKeyFilter","click .name":"_addNameFilter"},template:function(t){var e;return e=t.active?t.passed?"badge-success":"badge-important":"badge-warning",'<td class="center"><code class="key">'+t.id+"</code></td>"+'<td><span class="name">'+t.name+"</span></td>"+'<td class="right">'+_.formatDuration(t.duration)+"</td>"+'<td class="center"><span class="badge '+e+'">'+(t.passed?"passed":"failed")+"</span></td>"},_addKeyFilter:function(t){this._handleAddFilterEvent(t,"key")},_addNameFilter:function(t){this._handleAddFilterEvent(t,"name")},_handleAddFilterEvent:function(e,i){e.stopPropagation(),e.altKey&&t.trigger("filter",i+":"+$(e.target).text())}}),n=Dg.createGridLayout({gridRegions:{table:{view:Dg.TableView.extend({className:"test-table",itemView:s,headerView:i,template:function(t){return'<a id="'+t.crcId+'"></a><h3>'+t.title+"</h3>"+Dg.getTemplate("table")(t)},initialize:function(t){t=_.extend(t,{title:this.model.get("title"),crcId:this.model.get("crcId")})}})},toolbar:!1,quickSearch:!1,info:!1,perPage:!1,pager:{view:e}}}).extend({className:"box test-report",initialize:function(t){this.collection=t.model.get("tests")}}),a=Marionette.CollectionView.extend({itemView:n});ProbeDockRT.app.addInitializer(function(){var e=new a({collection:this.projects});t.on("filter",function(t){this.trigger("filter:add",t)},this),this.on("show:results:tables",function(){this.main.show(e)},this)})}.call(this),function(){var t=new Backbone.Wreqr.EventAggregator,e=Dg.RowView.extend({tagName:"div",events:{"click .code-key":"_addKeyFilter","click .code-fingerprint":"_addFingerprintFilter","click .title-name":"_addNameFilter","click .badge-tag":"_addTagFilter","click .badge-ticket":"_addTicketFilter","click .test-details-close":"_closeDetails","click .no-op":"_noOp",click:"_closeDetails"},ui:{message:".test-details-message"},template:function(t){var e,i,s;t.active?t.passed?(e="label-success",i="Passed",s="test-details-success"):(e="label-important",i="Failed",s="test-details-failed"):(e="label-warning",i="Inactive ("+(t.passed?"Passed":"Failed")+")",s="test-details-inactive");
var n="";_.each(t.tags,function(t){n+='<span class="badge badge-info pull-left badge-tag">'+t+"</span>"});var a="";return _.each(t.tickets,function(t){n+='<span class="badge badge-warning pull-left badge-ticket">'+t+"</span>"}),'<button class="test-details-close"><i class="icon-remove"></i></button><div class="well test-details box"><div class="row-fluid title-first-line '+s+'">'+'<div class="test-details-right-container pull-right">'+(t.key?'<code class="pull-left code-key">key: '+t.key+"</code>":"")+'<code class="pull-left code-fingerprint">fp:&nbsp;'+t.fingerprint+"</code>"+'<span class="label label-info pull-left no-op">'+_.formatDuration(t.duration)+"</span>"+'<span class="label pull-left no-op '+e+'">'+i+"</span>"+"</div>"+'<span class="title-name">'+t.name+" </span>"+"</div>"+'<div class="row-fluid title-second-line">'+'<div class="test-details-right-container pull-right">'+'<span class="label pull-left no-op">'+t.project+"</span>"+'<span class="label pull-left no-op">'+t.version+"</span>"+'<span class="label pull-left no-op">'+t.category+"</span>"+"</div>"+'<div class="test-details-left-container pull-left">'+n+a+"</div>"+"</div>"+'<pre class="test-details-message no-op"></pre>'+"</div>"},initialize:function(){this.listenTo(this.model,"change",this.render)},onRender:function(){this.ui.message.text(this.model.get("message"))},_addKeyFilter:function(t){this._handleAddFilterEvent(t,$(t.target).text().substr(5),"key")},_addFingerprintFilter:function(t){this._handleAddFilterEvent(t,$(t.target).text().substr(4),"fp")},_addNameFilter:function(t){this._handleAddFilterEvent(t,$(t.target).text(),"name")},_addTagFilter:function(t){this._handleAddFilterEvent(t,$(t.target).text(),"tag")},_addTicketFilter:function(t){this._handleAddFilterEvent(t,$(t.target).text(),"ticket")},_closeDetails:function(e){e.preventDefault(),e.stopPropagation(),t.trigger("remove:test:details",this.model)},_noOp:function(t){t.stopPropagation()},_handleAddFilterEvent:function(e,i,s){e.stopPropagation(),e.altKey&&t.trigger("filter",s,i)}}),i=Dg.createGridLayout({gridRegions:{table:{view:Dg.TableView.extend({itemViewContainer:".detail-tests",itemView:e,emptyView:Marionette.ItemView.extend({template:function(){return""}}),headerView:!1,template:function(){return'<div class="clearfix"><div class="detail-tests"></div></div>'}})},perPage:!1,toolbar:!1,pager:!1,quickSearch:!1,info:!1}});ProbeDockRT.app.addInitializer(function(){this.addRegions({detailsRegion:".details"});var e=new i({collection:this.details});e.listenTo(this.details,"sort",function(){e.render()}),t.on("filter",function(t,e){this.trigger("filter:add",t,e)},this),t.on("remove:test:details",function(t){this.trigger("remove:test:details",t)},this),this.on("show:details",function(){this.detailsRegion.show(e)},this),this.detailsRegion.show(e)})}.call(this),$(document).ready(function(){ProbeDockRT.app.start()});